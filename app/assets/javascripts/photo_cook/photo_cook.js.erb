window.PhotoCook = {
    resizeDirname: function() {
        return <%= PhotoCook.resize_dirname.to_json %>;
    },

    pixelRatio: (function() {
        var mediaQuery = '(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)';
        return function() {
            var ratio = window.devicePixelRatio;

            // If no ratio found check if screen is retina
            // and is so return 2x ratio
            if (ratio == null && typeof window.matchMedia === 'function') {
                if (window.matchMedia(mediaQuery).matches) {
                    ratio = 2;
                }
            }

            return ratio != null ? ratio : 1;
        };

    })()

};

window.PhotoCook.resize = function(path, width, height, crop) {
    if (path == null || width == null || height == null) { return path; }

    var ratio = PhotoCook.pixelRatio();
    var prefix = Math.round(width * ratio) + 'x' + Math.round(height * ratio) + '_';
    if (crop) { prefix += 'crop_'; }

    var index = path.lastIndexOf('/');
    return path.slice(0, index + 1)
            + PhotoCook.resizeDirname()
            + '/'
            + prefix
            + path.slice(index + 1);
};