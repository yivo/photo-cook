window.PhotoCook = {
    resizeDir: function() {
        return <%= PhotoCook.resize_dir.to_json %>;
    },

    pixelRatio: (function() {
        var mediaQuery = '(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)';
        return function() {
            var ratio = window.devicePixelRatio;

            // If no ratio found check if screen is retina
            // and if so return 2x ratio
            if (ratio == null && typeof window.matchMedia === 'function') {
                if (window.matchMedia(mediaQuery).matches) {
                    ratio = 2;
                }
            }

            return ratio != null ? ratio : 1;
        };
    })()
};

window.PhotoCook.resize = function(path, width, height, crop) {
    if (path == null) { return path; }

    var ratio = PhotoCook.pixelRatio();
    var command = '-' + (width ? Math.round(width * ratio) : '')
        + 'x'
        + (height ? Math.round(height * ratio) : '')
        + (crop ? 'crop' : '');

    var directory = path.slice(0, Math.max(path.lastIndexOf('/'), 0));

    var index = path.lastIndexOf('.');
    var extension = index >= 0 ? path.slice(index) : '';

    var basename = path.slice(
        directory ? directory.length + 1 : 0,
        extension ? 0 - extension.length : path.length
    );

    return (directory ? directory + '/' : directory)
            + PhotoCook.resizeDir()
            + '/'
            + basename
            + command
            + extension;
};